@model Collection
@using Microsoft.AspNetCore.Identity
@inject SignInManager<AppUser> SignInManager
@inject UserManager<AppUser> UserManager

@{
	Layout = "_Layout";
	ViewData["Title"] = "Chi tiết Album | Qotos";
	string userId = UserManager.GetUserId(User);
	string userName = UserManager.GetUserAsync(User).Result.UserName;
}

<div class="container my-5 pt-5">
	<h1>@Model.Title</h1>
	<div class="d-flex align-items-center">
		<a class="my-3 text-decoration-none link-dark me-auto" href="/accounts/&#64;@Model.User.UserName/profile">
			<img style="width: 32px; height: 32px; object-fit: cover" class="rounded-circle" src="@Model.User.Thumbnail"
				alt="">
			<span class="fw-bold">@Model.User.UserName</span>
		</a>

		@if (String.Equals(@Model.UserId, userId))
		{
			<button class="btn btn-outline-secondary btn-edit-collection" data-bs-toggle="modal"
				data-bs-target="#editCollectionModal" data-url="@Model.Id">Sửa</button>
		}
	</div>
</div>

<div class="container mb-3">
	@Model.PhotoCollections.Count() ảnh
</div>

<div class="container mb-5 pb-4">
	<div class="row">
		@foreach (var item in Model.PhotoCollections)
		{
			Photo photo = item.Photo;
			<div class="col-4 my-3">
				<div class="card">
					<a class="p-3 text-decoration-none link-dark" href="/accounts/&#64;@photo.User.UserName/profile">
						<img style="width: 32px; height: 32px; object-fit: cover" class="rounded-circle" src="@photo.User.Thumbnail"
							alt="" />
						<span class="fw-bold">@photo.User.UserName</span>
					</a>
					<img class="card-img-top btn-view" src="@photo.Thumbnail" alt="Card image" style="cursor: zoom-in;"
						data-bs-toggle="modal" data-bs-target="#viewPictureModal" data-url="/photos/view/@photo.Id" />
					<div class="card-body d-flex">
						@{
							var isLikedByCurrentUser = (userId != null) && photo.Likes.Any(l => l.UserId == userId);
						}
						<button class="btn @(isLikedByCurrentUser?"btn-outline-danger":"btn-outline-secondary") me-2 btn-like"
							data-url="/photos/like/@photo.Id">
							<i class="bi bi-heart-fill"></i>
						</button>
						<button class="btn btn-outline-secondary me-auto btn-collection" data-url="@photo.Id"><i
								class="bi bi-plus-square"></i></button>
						<button class="btn btn-outline-secondary btn-download" data-url="/photos/download/@photo.Id"><i
								class="bi bi-download"></i> Download</button>
					</div>
				</div>
			</div>
		}

	</div>
</div>

@* Modal Edit Picture *@
<div class="modal fade" id="editCollectionModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-body">
				<div class="row">
					<h2 class="mb-3">Cập nhật Album</h2>
					<form id="formUpdateCollection" method="post">
						<div class="mb-3">
							<label for="collectionNameUpdate" class="form-label">Tên Album</label>
							<input type="text" class="form-control" id="collectionNameUpdate" aria-describedby="emailHelp">
						</div>
						<div class="d-flex">
							<a href="#" class="link-danger me-auto" id="textDeleteCollection">Xoá Album</a>
							<span id="textUpdateCollection" style="display: none;" class="me-auto">Bạn có chắc muốn xoá? <a href=""
									class="link-secondary">Huỷ bỏ</a></span>
							<button type="submit" class="btn btn-primary btn-submit-collection">Lưu</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>

@section js {
	<script>
		let userId = '@userId';
		let userName = '@userName';
	</script>
	<script src="/js/collections/details.js"></script>
}